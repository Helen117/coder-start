<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>tooltip 内展示饼图</title>
    <script src="https://unpkg.com/react@15/dist/react.min.js"></script>
    <script src="https://unpkg.com/react-dom@15/dist/react-dom.min.js"></script>
    <script src="https://a.alipayobjects.com/g/datavis/g2/2.2.7/g2.js"></script>
    <script src="https://unpkg.com/g2-react@1.2.0/dist/index.js"></script>
    <script src="https://cdn.bootcss.com/babel-core/5.8.38/browser.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
<div id="c1"></div>
<script type="text/babel">
    const Chart = createG2(chart => {
        chart.col('value', {
            min: 0
        });
        chart.tooltip(true, {
            offset: 50,
            custom: true,
            html: '#p1'
        });
        chart.interval().position('name*value').color('name'); // 绘制柱状图
        chart.render();
        // 绘制 tooltip 中显示的饼图
        var chart2 = new G2.Chart({
            id: 'c4',
            animate: false,
            width: 150,
            height: 150,
            plotCfg: {
                margin: [0, 0, 35]
            }
        });
        chart2.coord('theta');
        chart2.legend('bottom', {
            title: null
        });
        // 查找对应的数据
        function findObj(name) {
            var rst = null
            data.forEach(function(item) {
                if (item.name === name) {
                    rst = item;
                }
            });
            return rst;
        }
        // 监听 tooltip 改变事件
        chart.on('tooltipchange', function(ev) {
            var item = ev.items[0]; // 获取tooltip要显示的内容
            var name = item.name;
            var obj = findObj(name);
            if (obj) {
                chart2.clear();
                chart2.source(obj.children);
                chart2.intervalStack().position(Stat.summary.percent('value')).color('name');
                chart2.render();
            }
        });
    });
    const HiddenStyle = {
        display: 'none'
    };
    const pieContainerStyle = {
        position: 'absolute',
        visibility: 'hidden',
        border : '1px solid #efefef',
        backgroundColor: 'white',
        opacity: '.8',
        padding: '5px',
        transition: 'top 200ms,left 200ms',
    };
    const MyComponent = React.createClass({
        getInitialState() {
            return {
                data: [{name:'类别1',value:10,children:[{name:'类别11',value:18},{name:'类别12',value:10},{name:'类别13',value:7},{name:'类别14',value:12}]},{name:'类别2',value:8,children:[{name:'类别21',value:28},{name:'类别22',value:20},{name:'类别23',value:7},{name:'类别24',value:2}]},{name:'类别3',value:4,children:[{name:'类别31',value:14},{name:'类别32',value:12},{name:'类别33',value:6},{name:'类别34',value:1}]},{name:'类别4',value:9,children:[{name:'类别41',value:38},{name:'类别42',value:10},{name:'类别43',value:17},{name:'类别44',value:22}]}],
                forceFit: true,
                height: 450
            };
        },
        render() {
            return (
                    <div>
                        <div style={HiddenStyle}>
                            <div id="p1" className="ac-tooltip" style={pieContainerStyle}>
                                <span>细节分步图</span>
                                <div id="c4"></div>
                            </div>
                        </div>
                        <Chart
                                data={this.state.data}
                                width={this.state.width}
                                height={this.state.height}
                                forceFit={this.state.forceFit} />
                    </div>
            );
        },
    });
    ReactDOM.render(<MyComponent />, document.getElementById('c1'));
</script>
</body>
</html>
